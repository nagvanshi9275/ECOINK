generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AdminUser {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // Hashed
  role      String   @default("ADMIN") // ADMIN, EDITOR
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 1. Hero Section (Banner Rotation)
model HeroBanner {
  id          String   @id @default(uuid())
  heading     String
  subheading  String?
  image       String
  ctaText     String?
  ctaLink     String?
  order       Int      @default(0)
  isVisible   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// 3. Sections (Reusable Schema)
model ContentSection {
  id          String   @id @default(uuid())
  internalName String  // Admin facing name
  type        String   // 'text', 'image-text', 'cta', 'features', etc.
  content     Json     // The actual data (heading, body, image, etc.)
  pages       PageSection[] 
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Join table for Page <-> ContentSection to allow ordering per page
model PageSection {
  id              String         @id @default(uuid())
  pageId          String
  page            Page           @relation(fields: [pageId], references: [id], onDelete: Cascade)
  sectionId       String
  section         ContentSection @relation(fields: [sectionId], references: [id])
  order           Int            @default(0)

  @@index([pageId])
}

// 2. Pages
model Page {
  id              String   @id @default(uuid())
  title           String
  slug            String   @unique
  isPublished     Boolean  @default(false)
  
  // Content Relations
  sections        PageSection[]
  
  // Legacy JSON fallback
  content         Json?    

  // SEO Fields (Consolidated/Expanded)
  seoTitle        String?
  seoDescription  String?
  seoKeywords     String? 
  focusKeyphrase  String?
  canonicalUrl    String?
  metaRobots      String?  @default("index,follow")
  
  // Social Media
  ogTitle         String?
  ogDescription   String?
  ogImage         String?
  ogType          String?  @default("website")
  twitterCard     String?  @default("summary_large_image")
  twitterTitle    String?
  twitterDescription String?
  twitterImage    String?

  // Structured Data
  schemaType      String?  @default("WebPage")
  schemaJson      Json?

  // Advanced SEO
  breadcrumbTitle String?
  noIndex         Boolean  @default(false)

  // Scoring
  seoScore        Int?     @default(0)
  readabilityScore Int?    @default(0)
  lastSeoAudit    DateTime?

  // Navbar Controls
  showInNavbar    Boolean  @default(false)
  navbarLabel     String?
  navbarOrder     Int      @default(0)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Deprecated (Keep for migration safety)
  metaTitle       String?
  metaDescription String?
  keywords        String? 
}

// 4. Blogs
model BlogPost {
  id              String   @id @default(uuid())
  title           String
  slug            String   @unique
  excerpt         String?
  content         String   @db.Text
  coverImage      String?
  coverImageAlt   String?
  isPublished     Boolean  @default(false)
  publishedAt     DateTime?
  authorId        String?

  // SEO Fields (Consolidated/Expanded)
  seoTitle        String?
  seoDescription  String?
  seoKeywords     String? 
  focusKeyphrase  String?
  canonicalUrl    String?
  metaRobots      String?  @default("index,follow")
  
  // Social Media
  ogTitle         String?
  ogDescription   String?
  ogImage         String?
  ogType          String?  @default("article")
  twitterCard     String?  @default("summary_large_image")
  twitterTitle    String?
  twitterDescription String?
  twitterImage    String?

  // Structured Data
  schemaType      String?  @default("Article")
  schemaJson      Json?

  // Advanced SEO
  breadcrumbTitle String?
  noIndex         Boolean  @default(false)
  noFollow        Boolean  @default(false)

  // Scoring
  seoScore        Int?     @default(0)
  readabilityScore Int?    @default(0)
  lastSeoAudit    DateTime?
  readingTime     Int?     @default(0)
  
  categoryId      String?
  category        Category? @relation(fields: [categoryId], references: [id])
  tags            Tag[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Deprecated
  metaTitle       String?
  metaDescription String?
  focusKeyword    String?
}

model Category {
  id          String     @id @default(uuid())
  name        String     @unique
  slug        String     @unique
  posts       BlogPost[]
}

model Tag {
  id          String     @id @default(uuid())
  name        String     @unique
  slug        String     @unique
  posts       BlogPost[]
}

// 5. Projects
model Project {
  id          String   @id @default(uuid())
  title       String
  slug        String   @unique
  description String
  content     String?  @db.Text
  location    String?
  category    String?
  client      String?
  completionDate DateTime?
  images      String[]
  heroImage   String?  
  heroImageAlt String?
  tags        Json?    
  galleryTitle    String?  
  gallerySubtitle String?  
  isVisible   Boolean  @default(true)

  // SEO Fields (Consolidated/Expanded)
  seoTitle        String?
  seoDescription  String?
  seoKeywords     String? 
  focusKeyphrase  String?
  canonicalUrl    String?
  metaRobots      String?  @default("index,follow")
  
  // Social Media
  ogTitle         String?
  ogDescription   String?
  ogImage         String?
  ogType          String?  @default("website")
  twitterCard     String?  @default("summary_large_image")
  twitterTitle    String?
  twitterDescription String?
  twitterImage    String?

  // Structured Data
  schemaType      String?  @default("WebPage")
  schemaJson      Json?

  // Advanced SEO
  breadcrumbTitle String?

  // Scoring
  seoScore        Int?     @default(0)
  readabilityScore Int?    @default(0)
  lastSeoAudit    DateTime?

  // Detail Page Specifics
  beforeImage       String?
  beforeImageAlt    String?
  afterImage        String?
  afterImageAlt     String?
  testimonialText   String?
  testimonialClient String?
  faqs              Json?    

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Deprecated
  metaTitle       String?
  metaDescription String?
}

// 6. Services
model Service {
  id          String   @id @default(uuid())
  name        String
  slug        String   @unique
  description String
  content     String?  @db.Text
  icon        String?  
  image       String?  
  imageAlt    String?
  heroImage   String?  
  heroImageAlt String?
  heroSubtitle String? 
  heroBadge   String?  
  ctaText     String?  
  ctaLink     String?
  ctaTitle    String?  
  ctaDescription String? 
  ctaBadge    String?  
  ctaPhone    String?  
  featureTitle    String?  
  featureSubtitle String? 
  featureBadge    String?  
  trustBadges     Json?    
  order       Int      @default(0)
  isVisible   Boolean  @default(true)
  features    Json?    
  galleryImages String[] 
  faqs          Json?    
  additionalContent String? @db.Text 
  testimonialIds String[] 

  // SEO Fields (Consolidated/Expanded)
  seoTitle        String?
  seoDescription  String?
  seoKeywords     String? 
  focusKeyphrase  String?
  canonicalUrl    String?
  metaRobots      String?  @default("index,follow")
  
  // Social Media
  ogTitle         String?
  ogDescription   String?
  ogImage         String?
  ogType          String?  @default("website")
  twitterCard     String?  @default("summary_large_image")
  twitterTitle    String?
  twitterDescription String?
  twitterImage    String?

  // Structured Data
  schemaType      String?  @default("Service")
  schemaJson      Json?

  // Advanced SEO
  breadcrumbTitle String?

  // Scoring
  seoScore        Int?     @default(0)
  readabilityScore Int?    @default(0)
  lastSeoAudit    DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Deprecated
  metaKeywords    String?  
}

// 7. Partners
model Partner {
  id          String   @id @default(uuid())
  name        String
  logoUrl     String
  websiteUrl  String?
  order       Int      @default(0)
  isVisible   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// 8. Navbar
model MenuItem {
  id        String     @id @default(uuid())
  label     String
  link      String
  parentId  String?    
  parent    MenuItem?  @relation("MenuHierarchy", fields: [parentId], references: [id])
  children  MenuItem[] @relation("MenuHierarchy")
  order     Int        @default(0)
  isVisible Boolean    @default(true)
}

// 10. Media (Library)
model MediaAsset {
  id          String   @id @default(uuid())
  filename    String
  url         String
  type        String   
  size        Int?     
  altText     String?  
  title       String?
  caption     String?
  focusArea   Json?    // {x, y}
  width       Int?
  height      Int?
  createdAt   DateTime @default(now())
}

// 11. Contact Messages
model ContactMessage {
  id          String   @id @default(uuid())
  name        String
  email       String
  phone       String?
  subject     String?
  message     String
  status      String   @default("UNREAD") 
  createdAt   DateTime @default(now())
}

// 12. Testimonials
model Testimonial {
  id          String   @id @default(uuid())
  clientName  String
  role        String?
  content     String
  avatarUrl   String?
  rating      Int      @default(5)
  isVisible   Boolean  @default(true)
  createdAt   DateTime @default(now())
}

// 13. FAQs
model FAQ {
  id          String   @id @default(uuid())
  question    String
  answer      String
  order       Int      @default(0)
  isVisible   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// 14. Global SEO Settings
model SeoSettings {
  id               Int      @id @default(1)
  
  // Site-wide Defaults
  siteName         String   @default("Magri Cabinets")
  siteTitle        String?
  siteDescription  String?
  defaultOgImage   String?

  // LocalBusiness Schema Data
  businessName     String?  @default("Magri Cabinets")
  businessType     String?  @default("LocalBusiness")
  streetAddress    String?
  addressLocality  String?  @default("Melbourne")
  addressRegion    String?  @default("VIC")
  postalCode       String?
  telephone        String?
  priceRange       String?  @default("$$")
  latitude         Float?
  longitude        Float?
  openingHours     Json?    

  // Social Media Links
  facebookUrl      String?
  instagramUrl     String?
  linkedinUrl      String?
  youtubeUrl       String?

  // Tracking & Verification
  googleAnalyticsId   String?
  googleSearchConsole String?
  googleTagManager    String?
  facebookPixel       String?

  // Sitemap Configuration
  sitemapEnabled      Boolean  @default(true)
  sitemapFrequency    String?  @default("weekly")

  updatedAt        DateTime @updatedAt
}

// 9 & 15. Global Site Settings
model GlobalSettings {
  id             Int      @id @default(1)
  siteName       String   @default("Magri Cabinets")
  siteLogo       String?
  
  // Footer
  footerContent  String?
  copyrightText  String?
  socialLinks    Json     
  
  // Contact Info
  contactEmail   String?
  contactPhone   String?
  address        String?
  
  // SEO Global (Keep for now or bridge)
  defaultMetaTitle String?
  defaultMetaDesc  String?
  favicon          String?

  // Hero Controls
  enableCustomHero Boolean  @default(false)
  heroBgImage      String?
  heroTitle        String?

  updatedAt      DateTime @updatedAt
}
model Redirect {
  id          String   @id @default(uuid())
  fromPath    String   @unique
  toPath      String
  statusCode  Int      @default(301)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
